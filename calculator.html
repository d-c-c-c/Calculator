<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="calculator.css">
    <title>Calculator</title>

  
</head>
<body>
    <div class="CalculatorContainer">
        <!-- The display of the calculator at the top -->
        <div class="calculatorDisplay">0</div> 

        <!-- This is where all of the keys will go -->
        <div class="calculatorKeys">
            <button class="keyOperator" data-action="add"><span>+</span></button>
            <button class="keyOperator" data-action="subtract"><span>-</span></button>
            <button class="keyOperator" data-action="multiply"><span>&times;</span></button>
            <button class="keyOperator" data-action="divide"><span>&divide;</span></button>
            <button><span>7</span></button>
            <button><span>8</span></button>
            <button><span>9</span></button>
            <button><span>4</span></button>
            <button><span>5</span></button>
            <button><span>6</span></button>
            <button><span>1</span></button>
            <button><span>2</span></button>
            <button><span>3</span></button>
            <button><span>0</span></button>
            <button id= "decimalButton" data-action="decimal"><span>.</span></button>
            <button id= "clearButton" data-action="clear"><span>AC</span></button>
            <button class="keyEqual" data-action="calculate"><span>=</span></button>
        </div>


    </div>

      <!-- Javascript Code -->
      <script>

        const calculator = document.querySelector('.CalculatorContainer');
        const keys = calculator.querySelector('.calculatorKeys');
        const display = document.querySelector('.calculatorDisplay')

        //Instantiating clear button value
        const clearButton = document.getElementById('clearButton');
       
        // TODO: Make a separate function for expressions like exponents, sin cos tan, log, etc
        // Call it 'calculateExpression'
        //rename 'calculate to calculateOperation'

        //Evaluate the input expression
        const calculate = (num1, operator, num2) => {
            const firstNum = parseFloat(num1)
            const secondNum = parseFloat(num2)
            if (operator === 'add') return firstNum + secondNum
            if (operator === 'subtract') return firstNum - secondNum
            if (operator === 'multiply') return firstNum * secondNum
            if (operator === 'divide') return firstNum / secondNum
        }
            
        // Returns the type of key that the user clicked
        const getKeyType = (key) => {
            const { action } = key.dataset

            //if key is a number 
            if (!action) return 'number'

            //if key is an operator
            if (
                action === 'add' ||
                action === 'subtract' ||
                action === 'multiply' ||
                action === 'divide'
            ) return 'operator'
            // for any other key, return the action
            return action
        }
        // Splitting event listener into pure and impure functions

            // Variables required
            // 1. keyContent
            // 2. displayedNumber
            // 3. previousKeyType
            // 4. action
            // 5. calculator.dataset.firstValue
            // 6. calculator.dataset.operator
            // 7. calculator.dataset.modValue

            // Returns the result of the calculator operation to the display screen
            // key: content of the clicked key
            // displayedNumber: content currently displayed on the calculator screen
            // state: shorthand variable for calculator.dataset. Used to to determine the data action for the clicked key, if it has one
            const createResultString = (key, displayedNumber, state) => {
                // Instantiating constants
                const keyContent = key.textContent
                const action = key.dataset.action
                const firstValue = state.firstValue
                const modValue = state.modValue
                const operator = state.operator
                const previousKeyType = state.previousKeyType
                const keyType = getKeyType(key)

                if (keyType === 'number') {
                    // calculator display
                    return 
                        displayedNumber === '0' ||
                        previousKeyType === 'operator' ||
                        previousKeyType === 'calculate'
                    ? keyContent : displayedNumber + keyContent //Ternery operator: return keycontent if it meets the conditions of the above statement
                                                             // Else: return displayedNum + keyContent
                    }

                // Decimal logic
                if (keyType === 'decimal') {
                    if (!displayedNumber.includes('.')) return displayedNumber + '.'
                    if (previousKeyType === 'operator' || previousKeyType === 'calculate') return '0.'
                    return displayedNumber
                }

                //Operator keys
                if (keyType = 'operator') {
                    const firstValue = calculator.dataset.firstValue
                    const operator = calculator.dataset.operator
                }

                return
                    firstValue &&
                    operator &&
                    previousKeyType !== 'operator' &&
                    previousKeyType !== 'calculate' 

                ? calculate(firstValue, operator, displayedNumber)
                :displayedNumber

                //Clear button logic
                if (keyType === 'clear') return 0

                //Calculate logic

                if (keyType == 'calculate') {
                    let firstValue = calculator.dataset.firstValue
                    const operator = calculator.dataset.operator
                    let modValue = calculator.dataset.modValue

                    return firstValue
                    ? previousKeyType === 'calculate'
                        ? calculate(displayedNumber, operator, modValue)
                        : calculate(firstValue, operator, displayedNumber)
                        
                    : displayedNumber
                    
                }
            }
        // Event listener
        keys.addEventListener('click', e => {
            if (e.target.matches('button')) return
            const displayedNumber = display.textContent
            const resultString = createResultString(e.target, displayedNumber, calculator.dataset)

        });

    </script>
</body>
</html>