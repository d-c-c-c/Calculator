<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="calculator.css">
    <title>Calculator</title>

  
</head>
<body>
    <div class="CalculatorContainer">
        <!-- The display of the calculator at the top -->
        <div class="calculatorDisplay">0</div> 

        <!-- This is where all of the keys will go -->
        <div class="calculatorKeys">
            <button class="keyOperator" data-action="add"><span>+</span></button>
            <button class="keyOperator" data-action="subtract"><span>-</span></button>
            <button class="keyOperator" data-action="multiply"><span>&times;</span></button>
            <button class="keyOperator" data-action="divide"><span>&divide;</span></button>
            <button><span>7</span></button>
            <button><span>8</span></button>
            <button><span>9</span></button>
            <button><span>4</span></button>
            <button><span>5</span></button>
            <button><span>6</span></button>
            <button><span>1</span></button>
            <button><span>2</span></button>
            <button><span>3</span></button>
            <button><span>0</span></button>
            <button id= "decimalButton" data-action="decimal"><span>.</span></button>
            <button id= "clearButton" data-action="clear"><span>AC</span></button>
            <button class="keyEqual" data-action="calculate"><span>=</span></button>
        </div>


    </div>

      <!-- Javascript Code -->
      <script>

        const calculator = document.querySelector('.CalculatorContainer');
        const keys = calculator.querySelector('.calculatorKeys');
        const display = document.querySelector('.calculatorDisplay')

        //Instantiating clear button value
        const clearButton = document.getElementById('clearButton');
       
        //Evaluate the input expression
        const calculate = (num1, operator, num2) => {
            let result = ''
            if (operator === "add") {
                result = parseFloat(num1) + parseFloat(num2)
            } else if (operator === "subtract") {
                result = parseFloat(num1) - parseFloat(num2)
            } else if (operator === "multiply") {
                result = parseFloat(num1) * parseFloat(num2)
            } else if (operator === "divide") {
                result = parseFloat(num1) / parseFloat(num2) //Come back to this to handle undefined results probably********
            }
            return result
        }

        // Event listener
        keys.addEventListener('click', e => {
            if (e.target.matches('button')) {
            // Setting constant for clicked button and the associated action
            const key = e.target;
            const action = key.dataset.action
            const keyContent = key.textContent //Contains the content of the selected key
            const displayedNumber = display.textContent // Contains the content of the calculator display; For if the display isn't "empty" (displaying 0)
            const previousKeyType = calculator.dataset.previousKeyType // Contains the info for the previous typed key

            //Once key is pressed again, remove is-depressed class from all keys
            Array.from(key.parentNode.children).forEach(i => i.classList.remove("is-depressed"))

            
            // If the key pressed was an operator button
            if(
                action === "add" ||
                action === "subtract" ||
                action === "multiply" ||
                action === "divide"
            ) {
                const firstValue = calculator.dataset.firstValue
                const secondValue = displayedNumber
                const operator = calculator.dataset.operator

                // Check that the first value and the operator exist; Second value will always exist when calculate is called
                if (firstValue && operator && 
                    previousKeyType !== 'operator' && 
                    previousKeyType !== 'calculate' && 
                    previousKeyType !== 'number') {
                    const calcValue = calculate(firstValue, operator, secondValue)
                    display.textContent = calcValue

                    //Update calculated value to first value
                    calculator.dataset.firstValue = calcValue
                } else {
                    calculator.dataset.firstValue = displayedNumber // If there are no calculations, set firstValue to the current displayed number
                }
                key.classList.add("is-depressed")
                console.log("Operator key pressed")
                
                
                //Select the previous operator
                calculator.dataset.previousKeyType = 'operator'
                calculator.dataset.operator = action // operator we will use for calculation
            } 

            
            console.log(previousKeyType)
            // If the key pressed was a number button
            
            if (!action) {
            // If there is nothing in the display, replace 0 with the selected number, else append that number onto the display
            // Swap Clear button from AC to CE
                if (displayedNumber === "0" || previousKeyType === 'operator' || previousKeyType === 'calculate') {  
                    display.textContent = keyContent;
                    if (keyContent !== '0' && clearButton.textContent === "AC") {
                        clearButton.getElementsByTagName("span")[0].textContent = "CE";
                    }
                    console.log(keyContent + " key pressed")
                } else {
                    display.textContent = displayedNumber + keyContent;
                    console.log(keyContent + " key pressed")
                }
                calculator.dataset.previousKeyType = 'number' // Set previousKeyType to a number
            }
            
            if(action === "decimal") {
                if (displayedNumber.includes(".")) {
                    //pass
                } else if (previousKeyType === 'operator' || previousKeyType === 'calculate') {
                    display.textContent = '0.'
                } else {
                    display.textContent = displayedNumber + "."
                }
                calculator.dataset.previousKeyType = 'decimal'
                console.log("Decimal key pressed")
            }
            
            if(action === "clear") {
                // If there is content in the display, reset it to 0
                // Reset Clear button from CE to AC
                if (displayedNumber !== "0") {
                    display.textContent = "0";
                    clearButton.getElementsByTagName("span")[0].textContent = "AC"
                    calculator.dataset.firstValue = ''
                    calculator.dataset.modValue = ''
                    calculator.dataset.operator = ''
                    calculator.dataset.previousKeyType = ''
                    console.log("Display cleared")
                }
                calculator.dataset.previousKeyType = 'clear'
                console.log("Clear key pressed")
            }
            
            if(action === "calculate") {
                let firstValue = calculator.dataset.firstValue
                let secondValue = displayedNumber
                const operator = calculator.dataset.operator

                // Check if the first number is set
                if (firstValue) {
                    // If the user clicks the equals sign multiple times, update firstValue to the displayed number
                    if (previousKeyType === 'calculate') {
                        firstValue = displayedNumber
                        secondValue = calculator.dataset.modValue
                    }
                    display.textContent = calculate(firstValue, operator, secondValue)
                }
                console.log(firstValue, operator, secondValue)
                console.log(calculate(firstValue, operator, secondValue))
                calculator.dataset.modValue = secondValue
                calculator.dataset.previousKeyType = 'calculate'
                console.log("Equals key pressed")
            } 
            
            
            }
        });

    </script>
</body>
</html>